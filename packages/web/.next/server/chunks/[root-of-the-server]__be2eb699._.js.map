{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///home/nodes/development/actual-nextgen/packages/web/src/server/db/sqlite.ts"],"sourcesContent":["/**\n * Thin SQLite wrapper — mirrors sync-server's db.js but typed.\n * Always runs server-side only (never bundled for the browser).\n */\nimport Database from 'better-sqlite3';\n\ntype Params = ReadonlyArray<string | number | null | Buffer>;\n\ntype MutateResult = { changes: number; insertId: number | bigint };\n\nclass WrappedDatabase {\n  private readonly db: Database.Database;\n\n  constructor(db: Database.Database) {\n    this.db = db;\n  }\n\n  all<T = Record<string, unknown>>(sql: string, params: Params = []): T[] {\n    const stmt = this.db.prepare(sql);\n    return stmt.all(...params) as T[];\n  }\n\n  first<T = Record<string, unknown>>(\n    sql: string,\n    params: Params = [],\n  ): T | null {\n    const rows = this.all<T>(sql, params);\n    return rows.length === 0 ? null : rows[0];\n  }\n\n  exec(sql: string): void {\n    this.db.exec(sql);\n  }\n\n  mutate(sql: string, params: Params = []): MutateResult {\n    const stmt = this.db.prepare(sql);\n    const info = stmt.run(...params);\n    return { changes: info.changes, insertId: info.lastInsertRowid };\n  }\n\n  transaction<T>(fn: () => T): T {\n    return this.db.transaction(fn)();\n  }\n\n  close(): void {\n    this.db.close();\n  }\n}\n\nexport type Db = WrappedDatabase;\n\nexport function openDatabase(filename: string): Db {\n  return new WrappedDatabase(new Database(filename));\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACD;;AAMA,MAAM;IACa,GAAsB;IAEvC,YAAY,EAAqB,CAAE;QACjC,IAAI,CAAC,EAAE,GAAG;IACZ;IAEA,IAAiC,GAAW,EAAE,SAAiB,EAAE,EAAO;QACtE,MAAM,OAAO,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;QAC7B,OAAO,KAAK,GAAG,IAAI;IACrB;IAEA,MACE,GAAW,EACX,SAAiB,EAAE,EACT;QACV,MAAM,OAAO,IAAI,CAAC,GAAG,CAAI,KAAK;QAC9B,OAAO,KAAK,MAAM,KAAK,IAAI,OAAO,IAAI,CAAC,EAAE;IAC3C;IAEA,KAAK,GAAW,EAAQ;QACtB,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC;IACf;IAEA,OAAO,GAAW,EAAE,SAAiB,EAAE,EAAgB;QACrD,MAAM,OAAO,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;QAC7B,MAAM,OAAO,KAAK,GAAG,IAAI;QACzB,OAAO;YAAE,SAAS,KAAK,OAAO;YAAE,UAAU,KAAK,eAAe;QAAC;IACjE;IAEA,YAAe,EAAW,EAAK;QAC7B,OAAO,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC;IAC7B;IAEA,QAAc;QACZ,IAAI,CAAC,EAAE,CAAC,KAAK;IACf;AACF;AAIO,SAAS,aAAa,QAAgB;IAC3C,OAAO,IAAI,gBAAgB,IAAI,sIAAQ,CAAC;AAC1C","debugId":null}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///home/nodes/development/actual-nextgen/packages/web/src/server/db/paths.ts"],"sourcesContent":["import { join, resolve } from 'node:path';\n\n/**\n * Data directory — defaults to ./data, overridden via DATA_DIR env var.\n * In Docker this is a mounted volume at /data.\n */\nexport const dataDir = resolve(process.env.DATA_DIR ?? './data');\nexport const serverFilesDir = join(dataDir, 'server-files');\nexport const userFilesDir = join(dataDir, 'user-files');\n\nexport function getPathForUserFile(fileId: string): string {\n  return join(resolve(userFilesDir), `file-${fileId}.blob`);\n}\n\nexport function getPathForGroupFile(groupId: string): string {\n  return join(resolve(userFilesDir), `group-${groupId}.sqlite`);\n}\n\nexport function getAccountDbPath(): string {\n  return join(resolve(serverFilesDir), 'account.sqlite');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;AAMO,MAAM,UAAU,IAAA,4HAAO,EAAC,QAAQ,GAAG,CAAC,QAAQ,IAAI;AAChD,MAAM,iBAAiB,IAAA,yHAAI,EAAC,SAAS;AACrC,MAAM,eAAe,IAAA,yHAAI,EAAC,SAAS;AAEnC,SAAS,mBAAmB,MAAc;IAC/C,OAAO,IAAA,yHAAI,EAAC,IAAA,4HAAO,EAAC,eAAe,CAAC,KAAK,EAAE,OAAO,KAAK,CAAC;AAC1D;AAEO,SAAS,oBAAoB,OAAe;IACjD,OAAO,IAAA,yHAAI,EAAC,IAAA,4HAAO,EAAC,eAAe,CAAC,MAAM,EAAE,QAAQ,OAAO,CAAC;AAC9D;AAEO,SAAS;IACd,OAAO,IAAA,yHAAI,EAAC,IAAA,4HAAO,EAAC,iBAAiB;AACvC","debugId":null}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///home/nodes/development/actual-nextgen/packages/web/src/server/db/account-db.ts"],"sourcesContent":["/**\n * Account database operations — server-side only.\n * Ports packages/sync-server/src/account-db.js to typed TypeScript.\n * The account DB stores: auth methods, sessions, users, user_access, server_prefs.\n */\nimport { mkdirSync } from 'node:fs';\nimport { dirname } from 'node:path';\n\nimport { type Db, openDatabase } from './sqlite';\nimport { getAccountDbPath } from './paths';\n\n// ─── Schema ─────────────────────────────────────────────────────────────────\n\nconst SCHEMA = `\nPRAGMA journal_mode=WAL;\n\nCREATE TABLE IF NOT EXISTS auth (\n  method       TEXT PRIMARY KEY,\n  display_name TEXT NOT NULL,\n  extra_data   TEXT,\n  active       INTEGER NOT NULL DEFAULT 0\n);\n\nCREATE TABLE IF NOT EXISTS sessions (\n  token       TEXT PRIMARY KEY,\n  expires_at  INTEGER NOT NULL,\n  user_id     TEXT,\n  auth_method TEXT\n);\n\nCREATE TABLE IF NOT EXISTS users (\n  id           TEXT PRIMARY KEY,\n  user_name    TEXT NOT NULL,\n  display_name TEXT,\n  enabled      INTEGER NOT NULL DEFAULT 1,\n  owner        INTEGER NOT NULL DEFAULT 0,\n  role         TEXT NOT NULL DEFAULT 'BASIC'\n);\n\nCREATE TABLE IF NOT EXISTS files (\n  id              TEXT PRIMARY KEY,\n  group_id        TEXT,\n  sync_version    TEXT,\n  name            TEXT NOT NULL,\n  encrypt_meta    TEXT,\n  encrypt_salt    TEXT,\n  encrypt_key_id  TEXT,\n  encrypt_test    TEXT,\n  owner           TEXT NOT NULL,\n  deleted         INTEGER NOT NULL DEFAULT 0\n);\n\nCREATE TABLE IF NOT EXISTS user_access (\n  user_id TEXT NOT NULL,\n  file_id TEXT NOT NULL,\n  PRIMARY KEY (user_id, file_id)\n);\n\nCREATE TABLE IF NOT EXISTS server_prefs (\n  key   TEXT PRIMARY KEY,\n  value TEXT NOT NULL\n);\n`;\n\n// ─── Singleton DB ────────────────────────────────────────────────────────────\n\nlet _accountDb: Db | undefined;\n\nexport function getAccountDb(): Db {\n  if (_accountDb === undefined) {\n    const path = getAccountDbPath();\n    mkdirSync(dirname(path), { recursive: true });\n    _accountDb = openDatabase(path);\n    _accountDb.exec(SCHEMA);\n  }\n  return _accountDb;\n}\n\n// ─── Types ───────────────────────────────────────────────────────────────────\n\nexport type Session = {\n  token: string;\n  expires_at: number;\n  user_id: string;\n  auth_method: string;\n};\n\nexport type User = {\n  id: string;\n  user_name: string;\n  display_name: string | null;\n  enabled: number;\n  owner: number;\n  role: string;\n};\n\nexport type AuthRow = {\n  method: string;\n  display_name: string;\n  extra_data: string | null;\n  active: number;\n};\n\n// ─── Session operations ──────────────────────────────────────────────────────\n\nexport const TOKEN_EXPIRATION_NEVER = -1;\n\nexport function getSession(token: string): Session | null {\n  return getAccountDb().first<Session>('SELECT * FROM sessions WHERE token = ?', [\n    token,\n  ]);\n}\n\nexport function clearExpiredSessions(): void {\n  const clearThreshold = Math.floor(Date.now() / 1000) - 3600;\n  const { changes } = getAccountDb().mutate(\n    'DELETE FROM sessions WHERE expires_at <> -1 AND expires_at < ?',\n    [clearThreshold],\n  );\n  if (changes > 0) {\n    console.log(`Cleared ${changes} expired sessions`);\n  }\n}\n\n// ─── Auth / bootstrap ────────────────────────────────────────────────────────\n\nexport function needsBootstrap(): boolean {\n  const rows = getAccountDb().all('SELECT * FROM auth');\n  return rows.length === 0;\n}\n\nexport function listLoginMethods(): Array<{\n  method: string;\n  active: boolean;\n  displayName: string;\n}> {\n  const rows = getAccountDb().all<AuthRow>(\n    'SELECT method, display_name, active FROM auth',\n  );\n  return rows.map((r) => ({\n    method: r.method,\n    active: r.active === 1,\n    displayName: r.display_name,\n  }));\n}\n\nexport function getActiveLoginMethod(): string | null {\n  const row = getAccountDb().first<{ method: string }>(\n    'SELECT method FROM auth WHERE active = 1',\n  );\n  return row?.method ?? null;\n}\n\nexport function getLoginMethod(\n  requestedMethod?: string | null,\n): string {\n  if (requestedMethod) {\n    return requestedMethod;\n  }\n  return getActiveLoginMethod() ?? 'password';\n}\n\n// ─── User operations ─────────────────────────────────────────────────────────\n\nexport function getUserInfo(userId: string): User | null {\n  return getAccountDb().first<User>('SELECT * FROM users WHERE id = ?', [userId]);\n}\n\nexport function getUserPermission(userId: string): string {\n  const row = getAccountDb().first<{ role: string }>(\n    'SELECT role FROM users WHERE id = ?',\n    [userId],\n  );\n  return row?.role ?? '';\n}\n\nexport function isAdmin(userId: string): boolean {\n  return getUserPermission(userId) === 'ADMIN';\n}\n\n// ─── Server prefs ────────────────────────────────────────────────────────────\n\nexport function getServerPrefs(): Record<string, string> {\n  const rows = getAccountDb().all<{ key: string; value: string }>(\n    'SELECT key, value FROM server_prefs',\n  );\n  return Object.fromEntries(rows.map((r) => [r.key, r.value]));\n}\n\nexport function setServerPrefs(prefs: Record<string, string>): void {\n  const db = getAccountDb();\n  db.transaction(() => {\n    for (const [key, value] of Object.entries(prefs)) {\n      db.mutate(\n        'INSERT INTO server_prefs (key, value) VALUES (?, ?) ON CONFLICT (key) DO UPDATE SET value = excluded.value',\n        [key, value],\n      );\n    }\n  });\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACD;AACA;AAEA;AACA;;;;;AAEA,+EAA+E;AAE/E,MAAM,SAAS,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDhB,CAAC;AAED,gFAAgF;AAEhF,IAAI;AAEG,SAAS;IACd,IAAI,eAAe,WAAW;QAC5B,MAAM,OAAO,IAAA,qKAAgB;QAC7B,IAAA,0HAAS,EAAC,IAAA,4HAAO,EAAC,OAAO;YAAE,WAAW;QAAK;QAC3C,aAAa,IAAA,kKAAY,EAAC;QAC1B,WAAW,IAAI,CAAC;IAClB;IACA,OAAO;AACT;AA6BO,MAAM,yBAAyB,CAAC;AAEhC,SAAS,WAAW,KAAa;IACtC,OAAO,eAAe,KAAK,CAAU,0CAA0C;QAC7E;KACD;AACH;AAEO,SAAS;IACd,MAAM,iBAAiB,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,QAAQ;IACvD,MAAM,EAAE,OAAO,EAAE,GAAG,eAAe,MAAM,CACvC,kEACA;QAAC;KAAe;IAElB,IAAI,UAAU,GAAG;QACf,QAAQ,GAAG,CAAC,CAAC,QAAQ,EAAE,QAAQ,iBAAiB,CAAC;IACnD;AACF;AAIO,SAAS;IACd,MAAM,OAAO,eAAe,GAAG,CAAC;IAChC,OAAO,KAAK,MAAM,KAAK;AACzB;AAEO,SAAS;IAKd,MAAM,OAAO,eAAe,GAAG,CAC7B;IAEF,OAAO,KAAK,GAAG,CAAC,CAAC,IAAM,CAAC;YACtB,QAAQ,EAAE,MAAM;YAChB,QAAQ,EAAE,MAAM,KAAK;YACrB,aAAa,EAAE,YAAY;QAC7B,CAAC;AACH;AAEO,SAAS;IACd,MAAM,MAAM,eAAe,KAAK,CAC9B;IAEF,OAAO,KAAK,UAAU;AACxB;AAEO,SAAS,eACd,eAA+B;IAE/B,IAAI,iBAAiB;QACnB,OAAO;IACT;IACA,OAAO,0BAA0B;AACnC;AAIO,SAAS,YAAY,MAAc;IACxC,OAAO,eAAe,KAAK,CAAO,oCAAoC;QAAC;KAAO;AAChF;AAEO,SAAS,kBAAkB,MAAc;IAC9C,MAAM,MAAM,eAAe,KAAK,CAC9B,uCACA;QAAC;KAAO;IAEV,OAAO,KAAK,QAAQ;AACtB;AAEO,SAAS,QAAQ,MAAc;IACpC,OAAO,kBAAkB,YAAY;AACvC;AAIO,SAAS;IACd,MAAM,OAAO,eAAe,GAAG,CAC7B;IAEF,OAAO,OAAO,WAAW,CAAC,KAAK,GAAG,CAAC,CAAC,IAAM;YAAC,EAAE,GAAG;YAAE,EAAE,KAAK;SAAC;AAC5D;AAEO,SAAS,eAAe,KAA6B;IAC1D,MAAM,KAAK;IACX,GAAG,WAAW,CAAC;QACb,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,OAAO,OAAO,CAAC,OAAQ;YAChD,GAAG,MAAM,CACP,8GACA;gBAAC;gBAAK;aAAM;QAEhB;IACF;AACF","debugId":null}},
    {"offset": {"line": 337, "column": 0}, "map": {"version":3,"sources":["file:///home/nodes/development/actual-nextgen/packages/web/src/server/accounts/password.ts"],"sourcesContent":["/**\n * Password-based auth — ports sync-server/src/accounts/password.js to TypeScript.\n */\nimport * as bcrypt from 'bcrypt';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport {\n  clearExpiredSessions,\n  getAccountDb,\n  TOKEN_EXPIRATION_NEVER,\n} from '../db/account-db';\n\nfunction isValidPassword(password: unknown): password is string {\n  return typeof password === 'string' && password.length > 0;\n}\n\nfunction hashPassword(password: string): string {\n  return bcrypt.hashSync(password, 12);\n}\n\nexport function bootstrapPassword(password: string): { error?: string } {\n  if (!isValidPassword(password)) {\n    return { error: 'invalid-password' };\n  }\n\n  const hashed = hashPassword(password);\n  const db = getAccountDb();\n\n  db.transaction(() => {\n    db.mutate(\"DELETE FROM auth WHERE method = 'password'\");\n    db.mutate('UPDATE auth SET active = 0');\n    db.mutate(\n      \"INSERT INTO auth (method, display_name, extra_data, active) VALUES ('password', 'Password', ?, 1)\",\n      [hashed],\n    );\n  });\n\n  return {};\n}\n\nexport function loginWithPassword(password: string): {\n  error?: string;\n  token?: string;\n} {\n  if (!isValidPassword(password)) {\n    return { error: 'invalid-password' };\n  }\n\n  const db = getAccountDb();\n  const authRow = db.first<{ extra_data: string }>(\n    \"SELECT extra_data FROM auth WHERE method = 'password'\",\n  );\n\n  if (!authRow?.extra_data) {\n    return { error: 'invalid-password' };\n  }\n\n  const confirmed = bcrypt.compareSync(password, authRow.extra_data);\n  if (!confirmed) {\n    return { error: 'invalid-password' };\n  }\n\n  // Find or create the password user account\n  const { totalOfUsers } = db.first<{ totalOfUsers: number }>(\n    'SELECT count(*) as totalOfUsers FROM users',\n  ) ?? { totalOfUsers: 0 };\n\n  let userId: string;\n\n  if (totalOfUsers === 0) {\n    userId = uuidv4();\n    db.mutate(\n      \"INSERT INTO users (id, user_name, display_name, enabled, owner, role) VALUES (?, '', '', 1, 1, 'ADMIN')\",\n      [userId],\n    );\n  } else {\n    const userRow = db.first<{ id: string }>(\n      \"SELECT id FROM users WHERE user_name = ''\",\n    );\n    if (!userRow) {\n      return { error: 'user-not-found' };\n    }\n    userId = userRow.id;\n  }\n\n  // Reuse or create session token\n  const sessionRow = db.first<{ token: string }>(\n    \"SELECT token FROM sessions WHERE auth_method = 'password'\",\n  );\n  const token = sessionRow?.token ?? uuidv4();\n\n  const expiration = TOKEN_EXPIRATION_NEVER;\n\n  if (!sessionRow) {\n    db.mutate(\n      \"INSERT INTO sessions (token, expires_at, user_id, auth_method) VALUES (?, ?, ?, 'password')\",\n      [token, expiration, userId],\n    );\n  } else {\n    db.mutate(\n      'UPDATE sessions SET user_id = ?, expires_at = ? WHERE token = ?',\n      [userId, expiration, token],\n    );\n  }\n\n  clearExpiredSessions();\n\n  return { token };\n}\n\nexport function changePassword(newPassword: string): { error?: string } {\n  if (!isValidPassword(newPassword)) {\n    return { error: 'invalid-password' };\n  }\n\n  const hashed = hashPassword(newPassword);\n  getAccountDb().mutate(\n    \"UPDATE auth SET extra_data = ? WHERE method = 'password'\",\n    [hashed],\n  );\n  return {};\n}\n"],"names":[],"mappings":"AAAA;;CAEC;;;;;;;;AACD;AACA;AAEA;;;;AAMA,SAAS,gBAAgB,QAAiB;IACxC,OAAO,OAAO,aAAa,YAAY,SAAS,MAAM,GAAG;AAC3D;AAEA,SAAS,aAAa,QAAgB;IACpC,OAAO,iHAAe,CAAC,UAAU;AACnC;AAEO,SAAS,kBAAkB,QAAgB;IAChD,IAAI,CAAC,gBAAgB,WAAW;QAC9B,OAAO;YAAE,OAAO;QAAmB;IACrC;IAEA,MAAM,SAAS,aAAa;IAC5B,MAAM,KAAK,IAAA,yKAAY;IAEvB,GAAG,WAAW,CAAC;QACb,GAAG,MAAM,CAAC;QACV,GAAG,MAAM,CAAC;QACV,GAAG,MAAM,CACP,qGACA;YAAC;SAAO;IAEZ;IAEA,OAAO,CAAC;AACV;AAEO,SAAS,kBAAkB,QAAgB;IAIhD,IAAI,CAAC,gBAAgB,WAAW;QAC9B,OAAO;YAAE,OAAO;QAAmB;IACrC;IAEA,MAAM,KAAK,IAAA,yKAAY;IACvB,MAAM,UAAU,GAAG,KAAK,CACtB;IAGF,IAAI,CAAC,SAAS,YAAY;QACxB,OAAO;YAAE,OAAO;QAAmB;IACrC;IAEA,MAAM,YAAY,oHAAkB,CAAC,UAAU,QAAQ,UAAU;IACjE,IAAI,CAAC,WAAW;QACd,OAAO;YAAE,OAAO;QAAmB;IACrC;IAEA,2CAA2C;IAC3C,MAAM,EAAE,YAAY,EAAE,GAAG,GAAG,KAAK,CAC/B,iDACG;QAAE,cAAc;IAAE;IAEvB,IAAI;IAEJ,IAAI,iBAAiB,GAAG;QACtB,SAAS,IAAA,mLAAM;QACf,GAAG,MAAM,CACP,2GACA;YAAC;SAAO;IAEZ,OAAO;QACL,MAAM,UAAU,GAAG,KAAK,CACtB;QAEF,IAAI,CAAC,SAAS;YACZ,OAAO;gBAAE,OAAO;YAAiB;QACnC;QACA,SAAS,QAAQ,EAAE;IACrB;IAEA,gCAAgC;IAChC,MAAM,aAAa,GAAG,KAAK,CACzB;IAEF,MAAM,QAAQ,YAAY,SAAS,IAAA,mLAAM;IAEzC,MAAM,aAAa,mLAAsB;IAEzC,IAAI,CAAC,YAAY;QACf,GAAG,MAAM,CACP,+FACA;YAAC;YAAO;YAAY;SAAO;IAE/B,OAAO;QACL,GAAG,MAAM,CACP,mEACA;YAAC;YAAQ;YAAY;SAAM;IAE/B;IAEA,IAAA,iLAAoB;IAEpB,OAAO;QAAE;IAAM;AACjB;AAEO,SAAS,eAAe,WAAmB;IAChD,IAAI,CAAC,gBAAgB,cAAc;QACjC,OAAO;YAAE,OAAO;QAAmB;IACrC;IAEA,MAAM,SAAS,aAAa;IAC5B,IAAA,yKAAY,IAAG,MAAM,CACnB,4DACA;QAAC;KAAO;IAEV,OAAO,CAAC;AACV","debugId":null}},
    {"offset": {"line": 452, "column": 0}, "map": {"version":3,"sources":["file:///home/nodes/development/actual-nextgen/packages/web/src/server/accounts/bootstrap.ts"],"sourcesContent":["/**\n * Bootstrap logic — initialises the server's auth on first run.\n * Ports sync-server/src/account-db.js bootstrap() to typed TypeScript.\n */\nimport { getAccountDb, needsBootstrap } from '../db/account-db';\nimport { bootstrapPassword, loginWithPassword } from './password';\n\ntype BootstrapSettings =\n  | { password: string }\n  | { openId: Record<string, unknown> };\n\ntype BootstrapResult = { error: string } | { token?: string };\n\nexport async function bootstrap(\n  settings: BootstrapSettings,\n): Promise<BootstrapResult> {\n  if (!settings) {\n    return { error: 'invalid-login-settings' };\n  }\n\n  const passEnabled = 'password' in settings;\n  const openIdEnabled = 'openId' in settings;\n\n  const db = getAccountDb();\n\n  const countRow = db.first<{ countOfOwner: number }>(\n    \"SELECT count(*) as countOfOwner FROM users WHERE user_name <> '' AND owner = 1\",\n  );\n  const countOfOwner = countRow?.countOfOwner ?? 0;\n\n  if (!openIdEnabled || countOfOwner > 0) {\n    if (!needsBootstrap()) {\n      return { error: 'already-bootstrapped' };\n    }\n  }\n\n  if (!passEnabled && !openIdEnabled) {\n    return { error: 'no-auth-method-selected' };\n  }\n\n  if (passEnabled && openIdEnabled) {\n    return { error: 'max-one-method-allowed' };\n  }\n\n  if (passEnabled) {\n    const { error } = bootstrapPassword(settings.password);\n    if (error) return { error };\n    return loginWithPassword(settings.password);\n  }\n\n  // openId bootstrap would go here (not ported yet — OpenID is future work)\n  return { error: 'openid-not-supported' };\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACD;AACA;;;AAQO,eAAe,UACpB,QAA2B;IAE3B,IAAI,CAAC,UAAU;QACb,OAAO;YAAE,OAAO;QAAyB;IAC3C;IAEA,MAAM,cAAc,cAAc;IAClC,MAAM,gBAAgB,YAAY;IAElC,MAAM,KAAK,IAAA,yKAAY;IAEvB,MAAM,WAAW,GAAG,KAAK,CACvB;IAEF,MAAM,eAAe,UAAU,gBAAgB;IAE/C,IAAI,CAAC,iBAAiB,eAAe,GAAG;QACtC,IAAI,CAAC,IAAA,2KAAc,KAAI;YACrB,OAAO;gBAAE,OAAO;YAAuB;QACzC;IACF;IAEA,IAAI,CAAC,eAAe,CAAC,eAAe;QAClC,OAAO;YAAE,OAAO;QAA0B;IAC5C;IAEA,IAAI,eAAe,eAAe;QAChC,OAAO;YAAE,OAAO;QAAyB;IAC3C;IAEA,IAAI,aAAa;QACf,MAAM,EAAE,KAAK,EAAE,GAAG,IAAA,+KAAiB,EAAC,SAAS,QAAQ;QACrD,IAAI,OAAO,OAAO;YAAE;QAAM;QAC1B,OAAO,IAAA,+KAAiB,EAAC,SAAS,QAAQ;IAC5C;IAEA,0EAA0E;IAC1E,OAAO;QAAE,OAAO;IAAuB;AACzC","debugId":null}},
    {"offset": {"line": 507, "column": 0}, "map": {"version":3,"sources":["file:///home/nodes/development/actual-nextgen/packages/web/src/app/api/account/bootstrap/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\n\nimport { bootstrap } from '@/server/accounts/bootstrap';\n\nconst BootstrapSchema = z.object({\n  password: z.string().min(1).optional(),\n  openId: z.record(z.unknown()).optional(),\n});\n\nexport async function POST(request: NextRequest) {\n  const body = await request.json().catch(() => null);\n  const parsed = BootstrapSchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(\n      { status: 'error', reason: 'invalid-request' },\n      { status: 400 },\n    );\n  }\n\n  const result = await bootstrap(parsed.data as Parameters<typeof bootstrap>[0]);\n\n  if ('error' in result) {\n    return NextResponse.json(\n      { status: 'error', reason: result.error },\n      { status: 400 },\n    );\n  }\n\n  return NextResponse.json({ status: 'ok', data: result });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAEA;;;;AAEA,MAAM,kBAAkB,yKAAC,CAAC,MAAM,CAAC;IAC/B,UAAU,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;IACpC,QAAQ,yKAAC,CAAC,MAAM,CAAC,yKAAC,CAAC,OAAO,IAAI,QAAQ;AACxC;AAEO,eAAe,KAAK,OAAoB;IAC7C,MAAM,OAAO,MAAM,QAAQ,IAAI,GAAG,KAAK,CAAC,IAAM;IAC9C,MAAM,SAAS,gBAAgB,SAAS,CAAC;IAEzC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,QAAQ;YAAS,QAAQ;QAAkB,GAC7C;YAAE,QAAQ;QAAI;IAElB;IAEA,MAAM,SAAS,MAAM,IAAA,wKAAS,EAAC,OAAO,IAAI;IAE1C,IAAI,WAAW,QAAQ;QACrB,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,QAAQ;YAAS,QAAQ,OAAO,KAAK;QAAC,GACxC;YAAE,QAAQ;QAAI;IAElB;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,QAAQ;QAAM,MAAM;IAAO;AACxD","debugId":null}}]
}